
<ul>
<% @pets.each do |p|%>
<li style="list-style: none" id="<%= p.id %>">
  <h3><%=link_to p.name, pet_path(p) %></h3>
  <p><%=p.breed%></p>
  <p><%=p.color%></p>
  <section>
    <% if p.image.present?%>
      <%= image_tag p.image[0].url(:thumb), class: 'image-index'%>
    <%end%>
  </section>
  <a id="choose-sighting">Did you see this pet?</a>
</li>
  <hr>
<%end%>
</ul>

<%= link_to 'Not one of those? Make a new spot!', new_sighting_path %>
<%= form_for @sighting do |f| %>
<h2>Pet description</h2>
 <div>
   <%= f.label :pet_type %>
   <%= f.text_field :pet_type %>
 </div>
 <div>
   <%= f.label :last_seen_at %>
    <%= f.text_field :last_seen_at %>
 </div>
 <div>
   <%= f.label :date_time %>
    <%= f.text_field :date_time %>
 </div>
 <div>
   <%= f.label :note %>
    <%= f.text_area :note %>
 </div>

 <div>
   <%= f.file_field :image %>
 </div>

 <h2>Your Contact Info (Optional)</h2>
 <div>
   <%= f.label :name %>
    <%= f.text_field :name %>
 </div>
 <div>
   <%= f.label :contact %>
    <%= f.text_field :contact %>
 </div>
 <%= f.submit %>
<% end %>

<div class="col-md-6">
  <input id="pac-input" class="controls" type="text" placeholder="Search Box">
  <div id="map" style='width: 100%; height: 400px;'></div>
</div>

<script type="text/javascript">
$(document).ready(function(){
  getLostPets();
});

$('li').click(function(){
  var petId = this.id
  var petArray = window.globals.allpets
  for (var i = 0; i < window.globals.allpets.length; i++) {
    if (petArray[i].id == petId) {
      $('#sighting_pet_type').val(petArray[i].pet_type);
      $('#sighting_note').val(`Color: ${petArray[i].color}, Breed: ${petArray[i].breed}`);
    }
  }
});

var getLostPets = function(){
  // Get all the lost pets and draw markers on the map
  $.get('/api/v1/pets', (data) => {
    window.globals.allpets = data;
    for (var i=0; i < data.length; i++){
      addLostPetsMarker({lat:data[i].lat, lng: data[i].lng}, map, data[i].name);
    }
  });
}

</script>
<div class="container">
  <h1 class="text-center">All Lost Pets</h1>



  <% @pets.each do |p|%>
    <div class="col-xs-6 col-sm-6 col-md-3">
      <div class="thumbnail">
        <% if p.image.present?%>
          <%= image_tag p.image[0].url(:large), class: 'image-index image-circle'%>
        <%else%>
         <img src="assets/image_dog_03@2x.png" alt="" />

        <%end%>
        <div class="caption">
          <h3><%=link_to p.name, pet_path(p) %></h3>
          <p><%=p.breed%></p>
          <p><%=p.color%></p>

          <%= link_to 'Did you see this pet?',  new_pet_sighting_path(p), class:'btn btn-default'%>
        </div>
      </div>
    </div>
  <%end%>

  <%= link_to 'Not one of those? Make a new spot!', new_sighting_path %>
</div>
